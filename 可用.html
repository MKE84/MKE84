<meta charset="UTF-8">    
<meta name="viewport" content="width=device-width, initial-scale=1.0">    
<style>
body { font-family: Arial, sans-serif; background:#f0f0f0; margin:10px; }    
h1 { text-align:center; }    
input, select, button, textarea { margin:4px; padding:4px; }    
table { width:100%; border-collapse:collapse; margin-top:10px; background:#fff; }    
th, td { border:1px solid #ccc; padding:6px; text-align:center; font-size:14px; }    
tr.available { background:#c8ffc8; }    
tr.unavailable { background:#ffc8c8; }    
tr.scanning { background:#fff3cd; }    
</style>    
</head>    <body>    <h1>Clash 节点生成器</h1>    <!-- 批量 -->    <textarea id="ipTextarea" rows="6" style="width:84%;" placeholder="请输入..."></textarea><br>    端口: <input type="number" id="ipPort" value="443">
类型:
<select id="ipType">

  <option>Trojan</option>    
</select>    
<button onclick="pasteIPs()">生成节点</button>    <!-- 表格 -->    <table>    
<thead>    
<tr>    
<th>名称</th><th>IP</th><th>端口</th><th>类型</th><th>延迟</th><th>状态</th><th>操作</th>    
</tr>    
</thead>    
<tbody id="nodeTable"></tbody>    
</table>    <button onclick="checkAll()">延迟检测</button>
<button onclick="exportClash()">导出配置</button>

<textarea id="clashOutput" rows="10" style="width:84%;" placeholder="展示..."></textarea><script>    
let nodes = [];    
    
/* ---------- 批量 ---------- */    
function pasteIPs(){    
  const text = document.getElementById('ipTextarea').value;    
  const defPort = parseInt(document.getElementById('ipPort').value);    
  const type = document.getElementById('ipType').value;    
    
  text.split(/\r?\n/).forEach(line => {    
    line = line.trim();    
    if (!line) return;    
    
    let ip = line, port = null, name = `个人-${nodes.length + 1}`;     
    if (line.includes(':')) {    
      const p = line.split(':');    
      ip = p[0];    
      port = parseInt(p[1]);    
      if (isNaN(port)) port = null;    
    }    
    
    nodes.push({    
      name,    
      ip,    
      port: port ?? defPort,    
      type,    
      delay: '-',    
      status: '待检测'    
    });    
  });    
  render();    
}    
/* ---------- 渲染表格 ---------- */    
function render() {    
  const tb = document.getElementById('nodeTable');    
  tb.innerHTML = '';    
  nodes.forEach((n, i) => {    
    const tr = document.createElement('tr');    
    tr.className =    
      n.status === '可用的' ? 'available' :    
      n.status === '不可用' ? 'unavailable' :    
      n.status === '扫描中' ? 'scanning' : '';    
    
    tr.innerHTML = `    
      <td>${n.name}</td>    
      <td>${n.ip}</td>    
      <td>${n.port ?? '-'}</td>    
      <td>${n.type}</td>    
      <td>${n.delay}</td>    
      <td>${n.status}</td>    
      <td><button onclick="nodes.splice(${i}, 1); render()">删除</button></td>    
    `;    
    tb.appendChild(tr);    
  });    
}    
    
/* ---------- 检测节点延迟 ---------- */    
async function checkNode(n) {    
  if (n.port) {    
    try {    
      const t = Date.now();    
      await fetch(`http://${n.ip}:${n.port}`, { method: 'HEAD', mode: 'no-cors' });    
      n.delay = Date.now() - t;    
      n.status = '可用的';    
    } catch {    
      n.status = '不可用';    
    }    
    return;    
  }    
    
  n.status = '扫描中';    
  render();    
  const r = await scanPorts(n.ip);    
  if (r) {    
    n.port = r.port;    
    n.delay = r.delay;    
    n.status = '可用的';    
  } else {    
    n.status = '不可用';    
  }    
}    
    
/* ---------- 扫描端口 ---------- */    
async function scanPorts(ip) {    
  try {    
    const t = Date.now();    
    await fetch(`http://${ip}:443`, { method: 'HEAD', mode: 'no-cors' });    
    return { port: 443, delay: Date.now() - t };    
  } catch {}    
  return null;    
}    
    
/* ---------- 全部检测 ---------- */    
async function checkAll() {    
  for (let n of nodes) {    
    await checkNode(n);    
    render();    
  }    
}    
    
/* ---------- Clash 导出 ---------- */    
function exportClash() {    
  const ok = nodes.filter(n => n.status === '可用的' && n.port);    
    
  const y = ok.map(n => {    
    const name = `${n.name || n.ip}:${n.port}`;    
    const t = n.type.toLowerCase();    
    return `    
- name: "${n.name || name}"    
  type: "${t}"    # 协议    
  server: ${n.ip}   # IP 地址    
  port: ${n.port}   # 端口    
  sni: "snippets.kkii.eu.org"    
  client-fingerprint: "chrome"    # 指纹伪装    
  tls: true           # 传输层安全性    
  password: "your_password"   # 安全密码    
  uuid: "b3c41578-c755-4492-9e5a-149ab82febdd" # 客户端    
  network: "ws"   # 协议来传输    
  ws-opts:    
    headers: {}   # WebSocket 头部设置    
    path: "/${n.ip}:${n.port}"  
    `;    
  }).join('\n');    
    
  const yaml = `proxies:\n${y.replace(/^/gm, '  ')}`;    
  document.getElementById('clashOutput').value = yaml;    
    
  const blob = new Blob([yaml], { type: 'text/yaml' });    
  const a = document.createElement('a');    
  a.href = URL.createObjectURL(blob);    
  a.download = '优质IP.yaml';    
  a.click();    
}    
</script>    </body>    
</html>